bl_info = {
    "name": "Cycle Through 3 Selection Modes", 
    "author": "Mustafa Ayhan",
    "version": (1, 0, 0),
    "blender": (5, .0, 1), 
    "location": "3D View > W Key",
    "description": "Cycle Through Selection Tools (Box, Circle, Lasso)",
    "category": "3D View",
}

import bpy
from bl_ui.space_toolsystem_common import ToolSelectPanelHelper

class VIEW3D_OT_cycle_selection_tools(bpy.types.Operator):
    """Cycle through selection tools (Box, Circle, Lasso)"""
    bl_idname = "view3d.cycle_selection_tools"
    bl_label = "Cycle Selection Tools"
    bl_options = {'REGISTER', 'UNDO'}

    def execute(self, context):
        # Define tool cycle order
        cycle_tools = [
            'builtin.select_box',
            'builtin.select_circle',
            'builtin.select_lasso',
        ]

        # Get current active tool
        current_tool = ToolSelectPanelHelper.tool_active_from_context(context)
        current_id = current_tool.idname if current_tool else None

        # Determine next tool index
        try:
            current_index = cycle_tools.index(current_id)
            next_index = (current_index + 1) % len(cycle_tools)
        except ValueError:
            next_index = 0

        # Set next tool
        try:
            bpy.ops.wm.tool_set_by_id(name=cycle_tools[next_index])
        except RuntimeError:
            self.report({'WARNING'}, "Tool unavailable in this context")
            return {'CANCELLED'}

        return {'FINISHED'}

# Global list to store keymap items
addon_keymaps = []

def register():
    bpy.utils.register_class(VIEW3D_OT_cycle_selection_tools)
    
    # Keymap registration
    wm = bpy.context.window_manager
    kc = wm.keyconfigs.addon
    if kc:
        km = kc.keymaps.new(name='3D View', space_type='VIEW_3D')
        kmi = km.keymap_items.new(VIEW3D_OT_cycle_selection_tools.bl_idname, 'W', 'PRESS')
        addon_keymaps.append((km, kmi))

def unregister():
    # Keymap unregistration
    for km, kmi in addon_keymaps:
        km.keymap_items.remove(kmi)
    addon_keymaps.clear()
    
    bpy.utils.unregister_class(VIEW3D_OT_cycle_selection_tools)

if __name__ == "__main__":
    register()
