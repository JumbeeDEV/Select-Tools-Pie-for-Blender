bl_info = {
    "name": "Cycle Through 3 Selection Modes", 
    "author": "Mustafa Ayhan",
    "version": (1, 0),
    "blender": (5.0.1), 
    "location": "3D View",
    "description": "Cycle Through 3 Selection Modes",
    "category": "3D View",
}

import bpy
from bl_ui.space_toolsystem_common import ToolSelectPanelHelper

class VIEW3D_OT_cycle_selection_tools(bpy.types.Operator):
    """Cycle through selection tools (Box, Lasso, Circle, Tweak)"""
    bl_idname = "view3d.cycle_selection_tools"
    bl_label = "Cycle Selection Tools"
    bl_options = {'REGISTER'}

    def execute(self, context):
        # Define tool cycle order
        cycle_tools = [
            'builtin.select_box',
            'builtin.select_circle',
            'builtin.select_lasso',
            #'builtin.select_tweak',
        ]

        # Get current active tool
        current_tool = ToolSelectPanelHelper.tool_active_from_context(context)
        current_id = current_tool.idname if current_tool else None

        # Determine next tool index
        try:
            current_index = cycle_tools.index(current_id)
            next_index = (current_index + 1) % len(cycle_tools)
        except ValueError:
            next_index = 0

        # Set next tool
        try:
            bpy.ops.wm.tool_set_by_id(name=cycle_tools[next_index])
        except RuntimeError:
            self.report({'WARNING'}, "Tool unavailable in this context")
            return {'CANCELLED'}

        return {'FINISHED'}

def add_keymap():
    wm = bpy.context.window_manager
    kc = wm.keyconfigs.addon
    if not kc:
        return

    km = kc.keymaps.get('3D View')
    if not km:
        km = kc.keymaps.new(name='3D View', space_type='VIEW_3D')

    # Assign to Shift+Q (customize this as needed)
    kmi = km.keymap_items.new(
        VIEW3D_OT_cycle_selection_tools.bl_idname,
        'W', 'PRESS', shift=False
    )

def remove_keymap():
    wm = bpy.context.window_manager
    kc = wm.keyconfigs.addon
    if not kc:
        return

    km = kc.keymaps.get('3D View')
    if km:
        for kmi in km.keymap_items:
            if kmi.idname == VIEW3D_OT_cycle_selection_tools.bl_idname:
                km.keymap_items.remove(kmi)
                break

def register():
    bpy.utils.register_class(VIEW3D_OT_cycle_selection_tools)
    add_keymap()

def unregister():
    remove_keymap()
    bpy.utils.unregister_class(VIEW3D_OT_cycle_selection_tools)

if __name__ == "__main__":
    register()
